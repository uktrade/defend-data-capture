{% extends "base.html" %}

{% block breadcrumbs %}
<nav class="govuk-breadcrumbs" aria-label="breadcrumbs">
    <ol class="govuk-breadcrumbs__list">
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href={% url 'index' %}>Home</a>
      </li>
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href="#">Update {{ view.supply_chain.name }}</a>
      </li>
    </ol>
</nav>
{% endblock %}

{% block body %}

    <h1 class="govuk-heading-xl"> Update {{ view.supply_chain.name }} </h1>

    {% if view.update_complete %}
        <div>
            <strong>
                Update completed
            </strong>
            <div>
                {{ view.completed_updates }} of {{ view.total_sa }} mandatory actions are complete.
            </div>
        </div>
    {% else %}
        <div class="govuk-warning-text">
            <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
            <strong class="govuk-warning-text__text">
                <span class="govuk-warning-text__assistive">Warning</span>
                Update incomplete
            </strong>
            <div class="tasklist-summary">{{ view.completed_updates }} of {{ view.total_sa }}
                mandatory actions are complete.</div>
        </div>
    {% endif %}

    <br>
    {% if view.submit_error %}
        <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
            <h2 class="govuk-error-summary__title" id="error-summary-title">
            There is a problem
            </h2>
            <div class="govuk-error-summary__body">
                Update strategic actions
            </div>
        </div>
    {% endif %}
    <br>

    {% if view.update_submitted %}
        <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title"      data-module="govuk-notification-banner">
            <div class="govuk-notification-banner__header">
            <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                Important
            </h2>
            </div>
            <div class="govuk-notification-banner__content">
            <p class="govuk-notification-banner__heading">
                All strategic action updates submited.
            </p>
            </div>
        </div>
    {% endif %}

    <table class="govuk-table">
        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">
                    <h2 class="govuk-heading-l tasklist-actions-header">Monthly strategic actions<br> updates</h2>
                </th>
                <th scope="col" class="govuk-table__header"></th>
            </tr>
        </thead>
        <tbody class="govuk-table__body">
            {% for update in view.sa_updates %}
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">
                    <a href={{ update.route }} class="govuk-link">Update strategic action {{ forloop.counter }} </a>
                    <p class="tasklist-action-description"> {{ update.description }} </p>
                </td>
                <td class="govuk-table__cell">
                    {% if update.status.label == "Not started" %}
                        <strong class="govuk-tag govuk-tag--grey">
                            {{ update.status.label }}
                        </strong>
                    {% elif update.status.label == "In progress" %}
                        <strong class="govuk-tag govuk-tag--blue">
                            {{ update.status.label }}
                        </strong>
                    {% else %}
                    <strong class="govuk-tag">
                        {{ update.status }}
                    </strong>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if view.sa_updates.has_other_pages %}
            <nav class="moj-pagination">
                <ul class="moj-pagination__list">
                    {% if view.sa_updates.has_previous %}
                        <li class="moj-pagination__item  moj-pagination__item--prev">
                            <a class="moj-pagination__link" href="?page={{ view.sa_updates.previous_page_number }}">Previous<span class="govuk-visually-hidden"> set of pages</span></a>
                        </li>
                    {% else %}
                        <li class="disabled"><span>&laquo;</span></li>
                    {% endif %}
                    {% for i in view.sa_updates.paginator.page_range %}
                        {% if view.sa_updates.number == i %}
                            <li class="moj-pagination__item moj-pagination__item--active">
                                <span>{{ i }}</span>
                            </li>
                        {% else %}
                            <li class="moj-pagination__item">
                                <a class="moj-pagination__link" href="?page={{ i }}">{{ i }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    {% if view.sa_updates.has_next %}
                        <li class="moj-pagination__item  moj-pagination__item--next">
                            <a class="moj-pagination__link" href="?page={{ view.sa_updates.next_page_number }}">Next<span class="govuk-visually-hidden"> set of pages</span></a>
                        </li>
                    {% else %}
                        <li class="disabled"><span>&raquo;</span></li>
                    {% endif %}
                </ul>
                <p class="moj-pagination__results">Displaying Strategic Actions <b>{{ view.sa_updates.start_index }}</b> - <b>{{ view.sa_updates.end_index }}</b> of <b>{{ view.sa_updates.paginator.count }}</b></p>
            </nav>
        {% endif %}
    <br>

    <h2 class="govuk-heading-l">Before you submit</h2>
    <p class="govuk-body">
        Before you submit, make sure you have updated and completed all<br>relevant sections. This includes:
    </p>
    <ul class="govuk-list govuk-list--bullet">
        <li>
            <a href="#" class="govuk-link">Supply chain summary</a>
            <span>
                - key information, vulnerability assessment,
                scenario assessment, maturity self assessment, risk monitoring,<br>archived strategic actions
            </span>
        </li>
        <li>
            <a href="#" class="govuk-link">Strategic action summary</a>
            <span>
                - description of the action, impact, strategic action framework category and depedencies
            </span>
        </li>
    </ul>


    {% if not view.update_submitted %}
        <form action={% url 'tlist' sc_slug=view.supply_chain.slug %} method="post">
            {% csrf_token %}
            <button class="govuk-button" data-module="govuk-button" type="submit">
                Submit update
            </button>
        </form>
    {% else %}
    <a href={% url 'index' %} class="govuk-back-link">Back</a>
    {% endif %}

{% endblock %}